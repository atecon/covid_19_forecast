clear
set verbose off

# SETTINGS
#==========
string DIR_WORK = "/home/at/git/covid_19_forecast"	#SET_PATH_HERE"		# e.g. "/home/git_project"
string DATA_URL = "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv"

scalar MAX_HORIZON = 7			# multi-step OoS forecast horizon
#===================

set workdir @DIR_WORK

# include helper functions
include "./src/helper.inp"
# 3rd party library
pkg install mat2data
include mat2data.gfn


# Download raw data and process
open @DATA_URL --preserve --quiet

print_countries(get_country_names(CountryRegion))

# take sum across regions for each day -- construct time-series
list data_values = v*
string filename = aggregate_data_and_store_csv(data_values)

# Load time-series + plot
open @filename --preserve --quiet
setobs 7 2020-01-22 --time-series
gnuplot cases_confirmed non_zero_regions \
  --time-series --with-lines --output=display


# Expost analysis + plot multistep  interval forecasts
# ARIMA(2,0,1)
arima_forecast(cases_confirmed, 2, 0, 1, MAX_HORIZON)

# ARIMA(2,1,1)
arima_forecast(cases_confirmed, 2, 1, 1, MAX_HORIZON)

# Add future dates
dataset addobs MAX_HORIZON
# ARIMA(2,0,1)
arima_forecast(cases_confirmed, 2, 0, 1, MAX_HORIZON)
# ARIMA(2,1,1)
arima_forecast(cases_confirmed, 2, 1, 1, MAX_HORIZON)




